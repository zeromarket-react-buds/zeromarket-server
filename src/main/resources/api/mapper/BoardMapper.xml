<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zeromarket.server.api.mapper.BoardMapper">


    <select id="selectBoardById" resultType="com.zeromarket.server.common.entity.Board"
        parameterType="Long">
        SELECT id,
               title,
               content,
               writer_id,
               status,
               created_at,
               updated_at
        FROM board
        WHERE id = #{id}
    </select>

    <select id="selectBoardList" parameterType="com.zeromarket.server.api.dto.BoardRequest"
        resultType="com.zeromarket.server.common.entity.Board">
        SELECT id,
        title,
        content,
        writer_id,
        status,
        created_at,
        updated_at
        FROM board
        <include refid="selectBoardListWhere"></include>
        ORDER BY id DESC
        LIMIT #{pageSize} OFFSET #{offset}
    </select>

    <select id="countBoard" resultType="Integer">
        SELECT count(id)
        FROM board
        <include refid="selectBoardListWhere"></include>
    </select>

    <sql id="selectBoardListWhere">
        <where>
            <if test="searchKeyword != null and searchKeyword != ''">
                <choose>
                    <when test="searchType == 'TITLE'">
                        AND title LIKE '%' || #{searchKeyword} || '%'
                    </when>
                    <when test="searchType == 'CONTENT'">
                        AND content LIKE '%' || #{searchKeyword} || '%'
                    </when>
                </choose>
            </if>
        </where>
    </sql>

    <insert id="insertBoard" parameterType="com.zeromarket.server.common.entity.Board"
        useGeneratedKeys="true"
        keyProperty="id"
        keyColumn="id">
        INSERT INTO board(title,
                          content,
                          writer_id,
                          status,
                          created_at,
                          updated_at)
        VALUES (#{title},
                #{content},
                #{writerId},
                #{status},
                now(),
                now())

            RETURNING id
    </insert>

    <update id="updateBoard" parameterType="com.zeromarket.server.common.entity.Board">
        UPDATE board
        SET title=#{title},
            content=#{content},
            writer_id=#{writerId},
            status=#{status},
            updated_at=now()
        WHERE id = #{id}
    </update>

    <delete id="deleteBoardById" parameterType="Long">
        DELETE
        FROM board
        WHERE id = #{id};
    </delete>
</mapper>